# Local Enumeration

* [System enumeration](#System-enumeration)
* [User and group enumeration](#user-and-group-enumeration)
* [Network enumeration](#Network-enumeration)
* [Firewall and antivirus enumeration](#Firewall-and-antivirus-enumeration)
* [Tools](#Tools)


## System enumeration
### OS version
```
meterpreter> systeminfo | findstr /B /C:"OS Name" /C:"OS Version"
```
### Windows hotfixes or patches have been installed
This information is useful for finetuning your approach in terms of vulnerabilities in the operating system that may have already been patched.

```
CMD> wmic qfe
```
### Enumerate Hostname
The hostname is used to identify systems on a network and may shed some light on the role of the system or the person the system belongs to.

```
CMD> hostname
```
### Enumerate Shares
Enumerate drives that are attached to the system.

```
CMD> wmic logicaldisk get caption

```
Enumerate Local shares:
```
CMD> net share
```

### Enumerate process running
Enumerate information regarding the processes that are currently running.

```
CMD> tasklist /SVC
```
## User and group enumeration:
Determine the current user:

```
CMD> whoami
```
Determine current user privileges:

```
CMD> whoami /priv
```
Determine the groups that our account is part of:

```
CMD> whoami /groups
```

Determine active user accounts:

```
CMD> net user
CMD> net user <username>
```

Identify Users logged onto the machine:
```
CMD> QWINSTA
```
Identify Administrators users:

```
CMD> net localgroup administrators
```

## Network enumeration:
Enumerating the target network interfaces:

```
CMD> ipconfig /all
CMD> route print
```
Enumerate services are running:

```
CMD> netstat -ano
```
## Firewall and antivirus enumeration:

Identify the status of Windows Defender:

```
CMD> sc query windefend
```
Identify the status of Microsoft Defender for Endpoints
```
CMD> sc query Sense

PS> Get-MpPreference | Select-Object -ExpandProperty RealTimeProtectionEnabled


```
If Microsoft Defender for Endpoint is enabled on a system, the following registry key should be present:
```
HKLM\SOFTWARE\Microsoft\ Windows Advanced Threat Protection\Status
```

To Identify third-party antivirus solutions. List the services that are running on the system.

```
CMD> sc queryex type=service
```

Enumerate information regarding the firewall's status and configuration.

```
CMD> netsh firewall show state
```
## Tools

### Local Exploit Suggester
The Local Exploit Suggester is a post-exploitation module for Metasploit that is used to scan a target for potential exploits based on operating system information. It automates the process of enumerating the system information and provides exploit recommendations based on the operating system's version and installed patches.

```
meterpreter> use post/multi/recon/local_exploit_suggester
meterpreter> set SESSION <Session Number>
meterpreter> run
```
### Windows Privilege Escalation Awesome Script (winPEAS) 
https://github.com/carlospolop/PEASS-ng/tree/master/winPEAS

### JAWS - Just Another Windows (Enum) Script
https://github.com/411Hall/JAWS

### HostEnum.ps1 (to test)
https://github.com/threatexpress/red-team-scripts/blob/master/HostEnum.ps1




    Vertical privilege escalation, sometimes referred to as privilege elevation, is when an attacker compromises a user account that has limited permissions on a system. They then look for ways to increase their privileges using the same account. For example, they might add the compromised account to the local administrator group.

    Horizontal privilege escalation, the more common method, is when an attacker gains access to another credential on the network with higher privileges than the initial one used to gain their foothold. With higher-level privileges, an attacker can move freely around the network without detection.


### Insecure service permissions

This occurs when a service that's running under SYSTEM privileges, but the User has permissions to change the executable binpath to one which could create a reverse shell.


### Unquoted service paths

 it’s still common to find many services with unquoted service paths. When combined with weak folder permissions, this allows an attacker to place an executable in a parent folder, where Windows will look for the executable first to execute. For example, you might have a service path as C:\Program Files\Vendor\binary.exe. When the path is unquoted and the User has permissions to place objects in the C:\Program Files\ path, Windows will first try to execute program.exe. If the attacker can place a binary called program.exe in the path, they can then elevate privileges to the account which that service is running.
 
 
### Weak registry permissions

if an attacker can modify the registry configuration of a service, they can then change the path in service configuration to execute a binary they choose. This could create a reverse shell or elevate privileges on the system.

### Insecure service executables

If an attacker can simply replace the original executable with their own, they can then gain privilege escalation of the account which that service is running under.

### Passwords

passwords for privileged users sitting in a text file on a desktop, in a browser, or in a configuration file. 

Searching the registry using the query: reg query HKLM /f password /t REG_SZ /s

Searching the file system within xml, ini and txt files for the string password: findstr /si password *.xml *.ini *.txt


### Overprivileged Users

standard business Users may have Local Administrator rights on their personal workstations. Attackers can leverage these Local Administrator rights to escalate privileges up to Full Domain using tools such as mimikatz and changes in the OS configuration.

### Security Account Manager (SAM)

Windows stores credentials within the Security Account Management (SAM) database in an encrypted form called a hash. This is a one-directional cryptographic algorithm, which means you need to know the original password to recreate the hash. The SAM and SYSTEM files are locked when Windows is running but an attacker might find a backup copy under the Windows repair directory. 

### Pass-the-hash


If an attacker can’t crack the password from the hash, they may still be able to move around the network using only the hash

Here are some examples of environments where PtH may not work or may be more difficult to execute:

Environments that use multi-factor authentication (MFA) - In environments that use MFA, even if an attacker is able to obtain a user's password hash, they will still need to bypass the second factor of authentication, such as a smart card or token. This can make it more difficult to use the PtH technique effectively.


Environments that use Kerberos authentication - In environments that use Kerberos authentication, the password hash is not stored in a local database, but rather in the Kerberos ticket-granting ticket (TGT). This can make it more difficult for an attacker to obtain the password hash and use the PtH technique.



### OS vulnerabilities or kernel exploits

A recent example known as Print Nightmare (CVE 2021 34527) is a vulnerability in the Print Spooler that enabled an attacker to perform remote code execution and privilege escalation.






